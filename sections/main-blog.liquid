<script
  src="{{ 'blog-posts-list.js' | asset_url }}"
  type="module"
  fetchpriority="low"
></script>

<style>
  /* Inline style to hide header ONLY on blog page - this section only renders on blog template */
  #header-group {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;
    height: 0 !important;
    overflow: hidden !important;
  }
</style>

<script>
  // 
  document.addEventListener('DOMContentLoaded', function() {
    const stickyHeader = document.querySelector('.blog-sticky-header');
    const blogTitle = stickyHeader ? stickyHeader.querySelector('.text-block') : null;
    const titleText = blogTitle ? blogTitle.querySelector('p') : null;
    const categoryNav = stickyHeader ? stickyHeader.querySelector('.blog-category-nav') : null;
    
    if (!stickyHeader || !blogTitle || !titleText) {
      console.log('Sticky header or blog title not found');
      return;
    }
    
    // Try multiple selectors to find the Shopify header
    let header = document.querySelector('#shopify-section-header');
    if (!header) header = document.querySelector('.shopify-section-header');
    if (!header) header = document.querySelector('header.header');
    if (!header) header = document.querySelector('.site-header');
    if (!header) header = document.querySelector('header[role="banner"]');
    if (!header) header = document.querySelector('header');
    if (!header) header = document.querySelector('[id*="shopify-section-header"]');
    
    console.log('Found header:', header);
    if (!header) {
      console.log('Header not found - trying to find any element with "header" in class/id');
      // List all potential headers
      const allHeaders = document.querySelectorAll('[class*="header"], [id*="header"]');
      console.log('All potential headers:', allHeaders);
      if (allHeaders.length > 0) {
        header = allHeaders[0];
        console.log('Using first potential header:', header);
      }
    }
    
    // Scroll range where shrinking happens
    const scrollStart = 0;      // Start shrinking immediately
    const scrollEnd = 180;      // Stop shrinking at 250px (faster)
    
    // Font size range (in vw units for responsiveness)
    const maxFontSize = 7;      // 7vw at top
    const minFontSize = 2.5;    // 2.5vw when fully scrolled
    
    // Title position range
    const titleTopStart = 9;   // 15rem starting position (matches bottom padding)
    const titleTopEnd = 1;      // 1rem ending position (aligned with buttons)
    
    // Force-hide Shopify header on this page at all times
    let headerGroup = document.getElementById('header-group');
    if (headerGroup) {
      headerGroup.style.display = 'none';
      headerGroup.style.visibility = 'hidden';
      headerGroup.style.opacity = '0';
      headerGroup.style.pointerEvents = 'none';
      headerGroup.style.height = '0';
    }
    
    function handleScroll() {
      const scrollY = window.scrollY;
      
      // Calculate progress (0 to 1) for title animation
      let progress = 0;
      if (scrollY >= scrollEnd) {
        progress = 1;
      } else if (scrollY > scrollStart) {
        progress = (scrollY - scrollStart) / (scrollEnd - scrollStart);
      }
      
      // Calculate current font size and apply via CSS variable (works with !important)
      const currentFontSize = maxFontSize - (progress * (maxFontSize - minFontSize));
      // Write CSS variable on both the container and the <p> to ensure it takes effect
      blogTitle.style.setProperty('--blog-title-vw', currentFontSize + 'vw');
      titleText.style.setProperty('--blog-title-vw', currentFontSize + 'vw');

      // Title moves up to align with logo/buttons: from 6rem to 1rem (same row as buttons)
      const currentTopRem = titleTopStart - (progress * (titleTopStart - titleTopEnd));
      blogTitle.style.setProperty('--title-padding-top', currentTopRem + 'rem');
      
      // Gradient background only appears when header is compact (title has shrunk significantly)
      // Start gradient when title animation is 70% complete
      const backgroundStart = scrollEnd * 0.7;  // Start at 70% of title animation
      const backgroundEnd = scrollEnd + 100;     // Fully opaque shortly after title finishes
      
      let backgroundProgress = 0;
      if (scrollY >= backgroundEnd) {
        backgroundProgress = 1;
      } else if (scrollY > backgroundStart) {
        backgroundProgress = (scrollY - backgroundStart) / (backgroundEnd - backgroundStart);
      }
      
      if (backgroundProgress > 0) {
        const gradientOpacity = 0.7 * backgroundProgress; // reduced from 0.98 to 0.7 for more transparency
        stickyHeader.style.setProperty('--sticky-bg-opacity', String(gradientOpacity));
      } else {
        stickyHeader.style.setProperty('--sticky-bg-opacity', '0');
      }
      
      // Gradient height should only cover the compact header area (title at 1rem + some buffer)
      // Fixed height in pixels to match compact header size
      stickyHeader.style.setProperty('--gradient-height', '120px');
      
    }
    
    // Initial check
    handleScroll();
    
    // Listen to scroll events with throttling for performance
    let ticking = false;
    window.addEventListener('scroll', function() {
      if (!ticking) {
        window.requestAnimationFrame(function() {
          handleScroll();
          ticking = false;
        });
        ticking = true;
      }
    });

    // --- Featured article slider for the first row -----------------------
    function initFeaturedSlider() {
      const grid = document.querySelector('.blog-posts-container--above-banners') || document.querySelector('.blog-posts-container--above-banner');
      const featuredItem = document.querySelector('.blog-posts-container--above-banner .blog-post-item.featured-article');
      if (!featuredItem || !grid) return;

      // Controls
      const prevBtn = featuredItem.querySelector('.featured-nav--prev');
      const nextBtn = featuredItem.querySelector('.featured-nav--next');
      if (!prevBtn || !nextBtn) return;

      // Templates for featured card content
      const templatesRoot = document.getElementById('featured-templates') || document.getElementById('featured-templates-root');
      if (!templatesRoot) return;

      const templateNodeList = (templatesRoot.content ? templatesRoot.content : templatesRoot).querySelectorAll('template');
      const templateNodes = Array.from(templateNodeList)
        .filter(function(t){ return t.hasAttribute('data-index'); })
        .sort(function(a,b){ return Number(a.getAttribute('data-index')) - Number(b.getAttribute('data-index')); });
      if (templateNodes.length === 0) return;

      let current = 0;
      let isAnimating = false;
      let animationFallback = null;

      function setNavEnabled(enabled){
        // Use pointer-events to avoid layout shifts from disabled attribute
        prevBtn.style.pointerEvents = enabled ? '' : 'none';
        nextBtn.style.pointerEvents = enabled ? '' : 'none';
        prevBtn.style.opacity = enabled ? '' : '0.4';
        nextBtn.style.opacity = enabled ? '' : '0.4';
      }

      function createCardFromTemplate(idx){
        const t = templateNodes[idx];
        if (!t) return null;
        const frag = t.content ? t.content.cloneNode(true) : document.createRange().createContextualFragment(t.innerHTML);
        const card = frag.querySelector('.blog-post-card');
        return card ? card : null;
      }

      function swapTo(index, dir){
        const oldCard = featuredItem.querySelector('.blog-post-card');
        const incoming = createCardFromTemplate(index);
        if (!incoming || !oldCard) return;

        // Ensure there is at most one incoming card at a time
        const existingIncoming = featuredItem.querySelector('.blog-post-card--incoming');
        if (existingIncoming && existingIncoming.parentNode) {
          existingIncoming.parentNode.removeChild(existingIncoming);
        }

        // Prepare incoming overlay
        incoming.classList.add('blog-post-card--incoming');
        incoming.style.position = 'absolute';
        incoming.style.top = '0';
        incoming.style.left = '0';
        incoming.style.right = '0';
        featuredItem.appendChild(incoming);

        // Animate cross-fade / slide
        requestAnimationFrame(function(){
          oldCard.classList.add('is-exiting');
          incoming.classList.add('is-entering');
        });

        function onDone(e){
          if (e && e.target !== incoming) return; // ensure event from incoming
          incoming.removeEventListener('transitionend', onDone);
          if (animationFallback) { clearTimeout(animationFallback); animationFallback = null; }
          // Remove old card, finalize incoming
          if (oldCard && oldCard.parentNode) oldCard.parentNode.removeChild(oldCard);
          incoming.classList.remove('blog-post-card--incoming','is-entering');
          incoming.style.removeProperty('position');
          incoming.style.removeProperty('top');
          incoming.style.removeProperty('left');
          incoming.style.removeProperty('right');
          isAnimating = false;
          setNavEnabled(true);
        }
        incoming.addEventListener('transitionend', onDone);
        // Fallback in case transitionend doesn't fire
        animationFallback = setTimeout(function(){ onDone({ target: incoming }); }, 600);
      }

      function go(delta){
        if (isAnimating) return;
        isAnimating = true;
        setNavEnabled(false);
        const total = templateNodes.length;
        if (total <= 1) return;
        current = (current + delta + total) % total;
        swapTo(current, delta);
      }

      prevBtn.addEventListener('click', function(ev){ ev.preventDefault(); go(-1); });
      nextBtn.addEventListener('click', function(ev){ ev.preventDefault(); go(1); });
    }

    // kick off slider after a tick so DOM is ready
    requestAnimationFrame(initWithCatch);
    function initWithCatch(){
      try { initFeaturedSlider(); } catch(e) { console && console.warn('Feature slider init error', e); }
    }
  });
</script>

<blog-posts-list section-id="{{ section.id }}" class="blog-page-wrapper">
  <div class="section-background section-background--blog color-{{ section.settings.color_scheme }}"></div>
  <div
    class="
      section
      color-{{ section.settings.color_scheme }}
      blog-posts
      spacing-style
      size-style
    "
    style="{% render 'spacing-style', settings: section.settings %}"
  >
    {%- comment -%} Sticky header wrapper for title and tag buttons {%- endcomment -%}
    <div class="blog-sticky-header">
      {%- comment -%} Custom blog header logo (acts as Home link) {%- endcomment -%}
      <a href="{{ routes.root_url }}" class="blog-logo-link" aria-label="Home">
        {%- if settings.logo != blank -%}
          <img
            src="{{ settings.logo | image_url: width: 240 }}"
            alt="{{ shop.name | escape }}"
            width="240"
            height="{{ 240 | divided_by: settings.logo.aspect_ratio | round }}"
            loading="eager"
          >
        {%- else -%}
          <span class="blog-logo-fallback">ব</span>
        {%- endif -%}
      </a>
      {%- comment -%} Category navigation buttons {%- endcomment -%}
      <div class="blog-category-nav">
        {%- liquid
          assign has_culture = false
          assign has_history = false
          assign has_theme = false
          assign has_misc = false

          for tag in current_tags
            assign h = tag | handleize
            case h
              when 'culture'
                assign has_culture = true
              when 'history'
                assign has_history = true
              when 'theme'
                assign has_theme = true
              when 'misc'
                assign has_misc = true
            endcase
          endfor
        -%}

        <a href="{{ blog.url }}" class="blog-category-btn{% if current_tags == blank %} active{% endif %}">All</a>
        <a href="{{ blog.url }}/tagged/culture" class="blog-category-btn{% if has_culture %} active{% endif %}">Culture</a>
        <a href="{{ blog.url }}/tagged/history" class="blog-category-btn{% if has_history %} active{% endif %}">History</a>
        <a href="{{ blog.url }}/tagged/theme" class="blog-category-btn{% if has_theme %} active{% endif %}">Theme</a>
        <a href="{{ blog.url }}/tagged/misc" class="blog-category-btn{% if has_misc %} active{% endif %}">Misc</a>
      </div>
      
      {% content_for 'blocks' %}
    </div>

    {%- paginate blog.articles by 12 -%}
      <span ref="viewMorePrevious"></span>
      
      {%- comment -%} First 6 articles (rows 1-3): 1 featured + 2 + 3 {%- endcomment -%}
      <div
        ref="grid"
        class="blog-posts-container blog-posts-container--above-banner"
        data-last-page="{{ paginate.pages }}"
      >
    {% for article in blog.articles limit: 6 %}
      <div
        class="blog-post-item{% if forloop.first %} featured-article{% endif %}"
        ref="cards[]"
        data-page="{{ paginate.current_page }}"
        data-index="{{ forloop.index0 }}"
      >
        {% content_for 'block', id: 'static-blog-post-card', type: '_blog-post-card', article: article %}
        {% if forloop.first %}
          <button class="featured-nav featured-nav--prev" aria-label="Previous article" type="button">
            &#10094;
          </button>
          <button class="featured-nav featured-nav--next" aria-label="Next article" type="button">
            &#10095;
          </button>
        {% endif %}
      </div>
    {% endfor %}
      </div>
      
  {%- comment -%} Newsletter banner after first 3 rows {%- endcomment -%}
  {%- capture banner_logo -%}
    {%- if section.settings.banner_logo != blank -%}
      <img
        src="{{ section.settings.banner_logo | image_url: width: 200 }}"
        alt="Newsletter logo"
        class="newsletter-banner__logo-img"
      >
    {%- else -%}
      <span class="newsletter-banner__logo">ব</span>
    {%- endif -%}
  {%- endcapture -%}
  <div class="newsletter-banner-wrapper">
    <a href="#Ecomsend_popups_open_281589" class="newsletter-banner">
      <div class="newsletter-banner__track">
        <div class="newsletter-banner__content">
          {{ banner_logo }}
          <span class="newsletter-banner__text">SIGN UP TO OUR NEWSLETTER</span>
          {{ banner_logo }}
          <span class="newsletter-banner__text">SIGN UP TO OUR NEWSLETTER</span>
          {{ banner_logo }}
          <span class="newsletter-banner__text">SIGN UP TO OUR NEWSLETTER</span>
          {{ banner_logo }}
          <span class="newsletter-banner__text">SIGN UP TO OUR NEWSLETTER</span>
          {{ banner_logo }}
          <span class="newsletter-banner__text">SIGN UP TO OUR NEWSLETTER</span>
          {{ banner_logo }}
          <span class="newsletter-banner__text">SIGN UP TO OUR NEWSLETTER</span>
          {{ banner_logo }}
          <span class="newsletter-banner__text">SIGN UP TO OUR NEWSLETTER</span>
        </div>
        <div class="newsletter-banner__content" aria-hidden="true">
          {{ banner_logo }}
          <span class="newsletter-banner__text">SIGN UP TO OUR NEWSLETTER</span>
          {{ banner_logo }}
          <span class="newsletter-banner__text">SIGN UP TO OUR NEWSLETTER</span>
          {{ banner_logo }}
          <span class="newsletter-banner__text">SIGN UP TO OUR NEWSLETTER</span>
          {{ banner_logo }}
          <span class="newsletter-banner__text">SIGN UP TO OUR NEWSLETTER</span>
          {{ banner_logo }}
          <span class="newsletter-banner__text">SIGN UP TO OUR NEWSLETTER</span>
          {{ banner_logo }}
          <span class="newsletter-banner__text">SIGN UP TO OUR NEWSLETTER</span>
          {{ banner_logo }}
          <span class="newsletter-banner__text">SIGN UP TO OUR NEWSLETTER</span>
        </div>
      </div>
    </a>
  </div>

  {%- comment -%} Hidden templates for featured slider (first 3 most recent articles) {%- endcomment -%}
  <template id="featured-templates-root">
    {% for article in blog.articles limit: 3 %}
      <template data-index="{{ forloop.index0 }}">
        {% content_for 'block', id: 'static-blog-post-card', type: '_blog-post-card', article: article %}
      </template>
    {% endfor %}
  </template>
  
  {%- comment -%} Social media buttons section {%- endcomment -%}
  <div class="social-media-buttons-wrapper">
    <div class="social-media-buttons">
      <a href="https://www.instagram.com/the.bideshi/" class="social-media-button social-media-button--instagram" target="_blank" rel="noopener noreferrer">
        <span class="social-media-button__text">Instagram</span>
        <span class="social-media-button__icon">↗</span>
      </a>
      <a href="https://www.youtube.com/@TheBideshi" class="social-media-button social-media-button--youtube" target="_blank" rel="noopener noreferrer">
        <span class="social-media-button__text">YouTube</span>
        <span class="social-media-button__icon">↗</span>
      </a>
    </div>
  </div>
  
  {%- comment -%} Articles after newsletter banner - all in rows of 3 {%- endcomment -%}
  <div
    ref="grid"
    class="blog-posts-container blog-posts-container--below-banner"
    data-last-page="{{ paginate.pages }}"
  >
    {% for article in blog.articles %}
      {% if forloop.index > 6 %}
        <div
          class="blog-post-item"
          ref="cards[]"
          data-page="{{ paginate.current_page }}"
        >
          {% content_for 'block', id: 'static-blog-post-card', type: '_blog-post-card', article: article %}
        </div>
      {% endif %}
    {% endfor %}
  </div>
  
  <span ref="viewMoreNext"></span>
  {%- endpaginate -%}
  </div>
</blog-posts-list>

{% stylesheet %}
  /**
   * Blog posts page layout
   */
  .blog-posts {
    /*     --page-content-width: var(--narrow-page-width); */
    --page-content-width: var(--normal-page-width);
    --page-width: calc(var(--page-content-width) + (var(--page-margin) * 2));
    --columns-gap: 36px;
    --rows-gap: 36px;
    overflow-x: clip;
    background-color: #d9d9d9;
  }

  /* Background for entire blog section */
  .section-background--blog {
    background-color: #d9d9d9 !important;
  }

  /* Sticky header wrapper for title and buttons */
  .blog-sticky-header {
    position: sticky !important;
    top: 0 !important;
    z-index: 100 !important;
    margin-inline: calc(50% - 50vw) !important;
    width: 100vw !important;
    max-width: 100vw !important;
    background-color: transparent;
    backdrop-filter: blur(0px);
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    align-items: center;
    overflow: visible;
    padding-top: 1rem; /* space for fixed buttons/logo */
    pointer-events: none; /* allow clicks to pass through to content below */
  }

  /* Full-width gradient layer - only covers compact header area */
  .blog-sticky-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100vw;
    height: var(--gradient-height, 120px); /* fixed height to only cover compact header */
    max-height: 150px; /* cap the maximum height */
    pointer-events: none;
    z-index: 0;
    background: linear-gradient(
      to bottom,
      rgba(255, 255, 255, var(--sticky-bg-opacity, 0)) 0%,
      rgba(255, 255, 255, calc(var(--sticky-bg-opacity, 0) * 0.8)) 40%,
      rgba(255, 255, 255, calc(var(--sticky-bg-opacity, 0) * 0.3)) 70%,
      rgba(255, 255, 255, 0) 90%,
      transparent 100%
    );
    backdrop-filter: blur(calc(8px * var(--sticky-bg-opacity, 0)));
  }

  /* Ensure title sits above gradient but below buttons */
  .blog-sticky-header .text-block {
    position: relative;
    z-index: 1;
  }

  /* Category navigation buttons - fixed at compact size */
  .blog-category-nav {
    position: absolute;
    top: 1rem; /* fixed position */
    right: 2rem;
    z-index: 2;
    display: flex;
    justify-content: flex-end;
    align-items: center;
    gap: 0.75rem;
    padding: 0;
    flex-wrap: wrap;
    pointer-events: auto; /* re-enable clicks for buttons */
  }

  /* Custom blog header logo (left side, same line as tags) - fixed at compact size */
  .blog-logo-link {
    position: absolute;
    top: 1rem; /* fixed position, same as buttons */
    left: 2rem;
    z-index: 2;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    pointer-events: auto; /* re-enable clicks for logo */
  }
  .blog-logo-link img {
    height: 28px; /* fixed compact size */
    width: auto;
    display: block;
    filter: drop-shadow(0 0 0 transparent);
  }
  .blog-logo-fallback {
    display: inline-block;
    height: 28px; /* fixed compact size */
    width: 28px;
    line-height: 28px;
    text-align: center;
    font-size: 18px;
    font-weight: 700;
    border-radius: 50%;
    background-color: #000;
    color: #fff;
  }

  .blog-category-btn {
    display: inline-block;
    padding: 0.2rem 0.7rem; /* fixed compact size */
    background-color: #f0f0f0;
    color: #777;
    text-decoration: none;
    border-radius: 9999px;
    font-size: 0.75rem; /* fixed compact size */
    font-weight: 300;
    font-style: italic;
    font-family: 'Georgia', serif;
    letter-spacing: 0.01em;
    transition: all 0.2s ease;
    border: 1px solid #d0d0d0;
    box-shadow: 
      0.5px 0.5px 3px rgba(0, 0, 0, 0.1),
      -1px -1px 3px rgba(255, 255, 255, 0.8);
  }

  .blog-category-btn:hover {
    background-color: #e8e8e8;
    color: #666;
    transform: translateY(-1px);
    box-shadow: 
  }

  .blog-category-btn.active {
    background-color: #333;
    color: #fff;
    font-weight: 500;
    box-shadow: 
      inset 1px 1px 3px rgba(0, 0, 0, 0.4),
      inset -1px -1px 2px rgba(255, 255, 255, 0.1);
  }

  @media screen and (max-width: 749px) {
    /* Hide category tag buttons on mobile (user request). Desktop unaffected. */
    .blog-category-nav,
    .blog-sticky-header.scrolled .blog-category-nav {
      display: none !important;
    }

    /* Keep logo visible and compact on mobile */
    .blog-logo-link {
      top: 0.75rem;
      left: 1rem;
    }
    .blog-logo-link img,
    .blog-logo-fallback {
      height: 28px;
      width: auto;
    }

    .blog-category-nav {
      position: static !important; /* revert overlay on mobile */
      padding: 1.5rem 1rem 1rem 1rem !important;
      gap: 0.75rem !important;
      justify-content: center !important; /* center buttons on mobile */
      left: auto !important;
      right: auto !important;
      transform: none !important;
      align-self: center !important; /* override parent align-items:flex-end */
      margin-inline: auto; /* ensure centering regardless of width */
    }

    .blog-category-btn {
      padding: 0.3rem 0.9rem;
      font-size: 0.85rem;
    }

    .blog-sticky-header.scrolled .blog-category-nav {
      position: static !important;
      padding: 0.5rem 1rem 0.5rem 1rem !important;
      justify-content: center !important; /* keep centered when scrolled */
      left: auto !important;
      right: auto !important;
      transform: none !important;
      align-self: center !important; /* keep centered when sticky header aligns to end */
      margin-inline: auto;
    }

    .blog-sticky-header.scrolled .blog-category-btn {
      padding: 0.2rem 0.65rem;
      font-size: 0.7rem;
    }
  }

  /* Newspaper-style blog title (inside sticky header) - additional styling */
  .blog-sticky-header .text-block {
    text-align: center !important;
    background-color: transparent !important;
    margin: 0 !important;
    padding-top: var(--title-padding-top, 9rem) !important; /* animated by JS - starts at 15rem to match bottom */
    padding-bottom: 9rem !important; /* space between title and first article */
    padding-left: 0 !important;
    padding-right: 0 !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    box-sizing: border-box !important;
    overflow-wrap: break-word !important;
    width: 100% !important;
  }

  .blog-sticky-header .text-block p {
    font-family: 'Playfair Display', 'Georgia', serif !important;
    font-size: clamp(1.5rem, var(--blog-title-vw, 7vw), 9.5rem) !important;
    font-weight: 900 !important;
    letter-spacing: 0.12em !important;
    text-transform: uppercase !important;
    line-height: 1.1 !important;
    margin: 0 auto !important;
    padding: 0 !important;
    color: #2c2c2c !important;
    text-align: center !important;
    word-wrap: break-word !important;
    overflow-wrap: break-word !important;
    hyphens: auto !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
    transition: font-size 0.1s ease-out !important;
  }

  

  @media screen and (max-width: 749px) {
    /* Reduce top/bottom padding for title on mobile */
    .blog-sticky-header .text-block {
      padding: 1.25rem 0 0.75rem 0 !important;
    }

    .blog-sticky-header .text-block p {
      font-size: clamp(1.2rem, var(--blog-title-vw, 7vw), 3.5rem) !important;
      letter-spacing: 0.08em !important;
    }
  }

  @media screen and (max-width: 1024px) and (min-width: 750px) {
    .blog-sticky-header .text-block p {
      font-size: clamp(2rem, var(--blog-title-vw, 7vw), 7rem) !important;
    }
  }

  .blog-posts-container {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 1rem;
    width: 100%;
    column-gap: var(--columns-gap);
    row-gap: var(--rows-gap);
    align-items: stretch;
  }

  /**
   * Apart from the first and second rows in the grid, all remaining blog posts
   * are arranged in a three-column layout:
   * +------------+------------+-------------+
   * |            |            |             |
   * |  (span 2)  |  (span 2)  |  (span 2)   |
   * |            |            |             |
   * +------------+------------+-------------+
   */
  .blog-post-item {
    --blog-post-card-scale: 0.6;
    display: flex;
    height: 100%;

    grid-column: span 2;

    @media screen and (max-width: 749px) {
      --blog-post-card-scale: 0.5;

      grid-column: span 6;
    }
  }

  /**
   * The second row of blog posts has two columns:
   * +-------------------+-------------------+
   * |                   |                   |
   * |  (column span 3)  |  (column span 3)  |
   * |                   |                   |
   * +-------------------+-------------------+
   */
  .blog-posts-container--above-banner .blog-post-item:nth-child(2),
  .blog-posts-container--above-banner .blog-post-item:nth-child(3) {
    --blog-post-card-scale: 0.7;
    display: flex;
    height: 100%;

    grid-column: span 3;

    @media screen and (max-width: 749px) {
      --blog-post-card-scale: 0.5;

      grid-column: span 6;
    }
  }

  /**
   * Make images square for all rows except the first (featured) article
   * This applies to row 2, 3, and all rows below the banner
   */
  .blog-posts-container--above-banner .blog-post-item:not(:first-child) .blog-post-card__image-container,
  .blog-posts-container--below-banner .blog-post-item .blog-post-card__image-container {
    aspect-ratio: 1 / 1;
    overflow: hidden;
  }

  .blog-posts-container--above-banner .blog-post-item:not(:first-child) .blog-post-card__image-container img,
  .blog-posts-container--below-banner .blog-post-item .blog-post-card__image-container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
  }

  /**
   * The first row of blog posts has only one column:
   * +---------------------------------------+
   * |                                       |
   * |           (1 column span 6)           |
   * |                                       |
   * +---------------------------------------+
   */
  .blog-posts-container--above-banner .blog-post-item:first-child {
    --blog-post-card-scale: 1;
    display: flex;
    height: auto;
    min-height: 0;

    /* Span entire grid and bleed to viewport edges */
    grid-column: 1 / -1;
    margin-inline: calc(50% - 50vw);
  }

  /* Ensure the featured container can host absolutely-positioned children (nav buttons, transitions) */
  .blog-posts-container--above-banner .blog-post-item.featured-article {
    position: relative;
  }

  /* Featured image navigation buttons */
  .featured-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 3;
    background: none;
    border: none;
    color: #000;
    font-size: 6rem;
    cursor: pointer;
    padding: 0;
    line-height: 1;
    transition: transform .2s ease, opacity .2s ease;
    opacity: 0.85;
  }
  .featured-nav:hover { opacity: 1; transform: translateY(-50%) scale(1.1); }
  .featured-nav--prev { left: 24px; }
  .featured-nav--next { right: 24px; }

  /* Cross-fade + slide animation for swapping featured card content */
  .blog-post-item.featured-article .blog-post-card { transition: opacity .35s ease, transform .35s ease; }
  .blog-post-item.featured-article .blog-post-card.is-exiting { opacity: 0; transform: translateX(-2%); }
  .blog-post-item.featured-article .blog-post-card--incoming { opacity: 0; transform: translateX(2%); }
  .blog-post-item.featured-article .blog-post-card--incoming.is-entering { opacity: 1; transform: translateX(0); }

  /* Mobile: hide featured prev/next arrows */
  @media screen and (max-width: 749px) {
    .featured-nav { display: none !important; }
  }

  /**
   * Articles below banner: horizontal scrolling layout
   */
  .blog-posts-container--below-banner {
    display: flex;
    flex-direction: row;
    gap: 1.5rem;
    overflow-x: auto;
    overflow-y: hidden;
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
    padding: 2rem 0 3rem 0;
    margin-bottom: 3rem;
    position: relative;
    /* Break out of page margins - extend to viewport edges */
    margin-inline: calc(50% - 50vw);
    width: 100vw;
    /* Add left padding to align first card with page content */
    padding-left: max(2rem, calc(50vw - var(--page-content-width) / 2));
    padding-right: 2rem;
    /* Scroll padding ensures first item snaps at the left padding position */
    scroll-padding-left: max(2rem, calc(50vw - var(--page-content-width) / 2));
    /* Hide scrollbar but keep functionality */
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE/Edge */
  }
  
  .blog-posts-container--below-banner::-webkit-scrollbar {
    display: none; /* Chrome/Safari */
  }

  .blog-posts-container--below-banner .blog-post-item {
    flex: 0 0 350px; /* Fixed width cards */
    min-width: 350px;
    max-width: 350px;
    scroll-snap-align: start;
    scroll-snap-stop: normal;
  }
  
  /* First article maintains left margin alignment */
  .blog-posts-container--below-banner .blog-post-item:first-child {
    scroll-snap-align: start;
    margin-left: 0; /* No extra margin needed, padding handles it */
  }

  @media screen and (max-width: 749px) {
    .blog-posts-container--below-banner .blog-post-item {
      flex: 0 0 280px;
      min-width: 280px;
      max-width: 280px;
    }
    
    .blog-posts-container--below-banner {
      padding-top: 1.5rem;
      padding-bottom: 2rem;
      padding-left: 1rem;
      padding-right: 1rem;
      scroll-padding-left: 1rem;
    }
  }

  /**
   * Blog post item styling - removed old border styling as cards now have their own styling
   */
  .blog-post-item {
    padding: 0;
  }

  .blog-post-item:has(.blog-post-card__image-container) {
    padding: 0;
  }

  /* Ensure equal heights for cards in the same row */
  .blog-posts-container .blog-post-item {
    align-self: stretch;
  }

  .blog-posts-container--above-banner .blog-post-item:nth-child(2),
  .blog-posts-container--above-banner .blog-post-item:nth-child(3) {
    align-self: stretch;
  }

  /**
   * Newsletter Marquee Banner
   */
  .newsletter-banner-wrapper {
    width: 100vw;
    overflow: hidden;
    margin: 3rem 0 0 0;
    position: relative;
    left: 50%;
    transform: translateX(-50%);
  }

  .newsletter-banner {
    display: block;
    background-color: #fbbf24;
    padding: 2.5rem 0;
    overflow: hidden;
    text-decoration: none;
    border-top: 3px solid #000;
    border-bottom: 3px solid #000;
    width: 100%;
    --banner-font-size: 4.5rem; /* shared size for text and logo image */
  }

  .newsletter-banner__track {
    display: inline-flex;
    white-space: nowrap;
    animation: scroll-marquee 20s linear infinite;
    will-change: transform;
  }

  .newsletter-banner__content {
    display: inline-flex;
    align-items: center;
    gap: 3rem;
    white-space: nowrap;
    padding-right: 33.5rem; /* increased spacing to prevent overlap at seam */
  }

  .newsletter-banner__logo {
    font-size: var(--banner-font-size);
    font-weight: 700;
    color: #000;
    line-height: 1;
  }

  .newsletter-banner__text {
    font-family: 'Playfair Display', 'Georgia', serif;
    font-size: var(--banner-font-size);
    font-weight: 700;
    font-style: italic;
    color: #000;
    letter-spacing: 0.05em;
    line-height: 1;
  }
  
  /* Logo image sized to match text height dynamically */
  .newsletter-banner__logo-img {
    height: var(--banner-font-size); /* match text size */
    width: auto;
    display: inline-block;
    vertical-align: baseline;
  }

  @keyframes scroll-marquee {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
  }

  /**
   * Social Media Buttons Section
   */
  .social-media-buttons-wrapper {
    width: 100vw;
    margin: 0 0 3rem 0;
    position: relative;
    left: 50%;
    transform: translateX(-50%);
  }

  .social-media-buttons {
    display: flex;
    background-color: #d9d9d9;
    border-top: none; /* Remove top border since newsletter banner has bottom border */
    border-bottom: 3px solid #000;
    width: 100%;
  }

  .social-media-button {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
    padding: 1.5rem 2rem;
    text-decoration: none;
    color: #000;
    font-family: 'Playfair Display', 'Georgia', serif;
    font-size: 2.5rem;
    font-weight: 400;
    transition: background-color 0.2s ease;
    position: relative;
  }

  .social-media-button:not(:last-child)::after {
    content: '';
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    width: 3px;
    background-color: #000;
  }

  .social-media-button:hover {
    background-color: #fbbf24;
  }

  .social-media-button__text {
    display: block;
    text-align: left;
    flex: 1;
  }

  .social-media-button__icon {
    display: inline-block;
    font-size: 1.75rem;
    vertical-align: middle;
    line-height: 1;
    flex-shrink: 0;
  }

  @media screen and (max-width: 749px) {
    .newsletter-banner {
      padding: 1.5rem 0;
      --banner-font-size: 2rem; /* mobile scale */
    }

    .newsletter-banner__content {
      gap: 2rem;
    }

    .newsletter-banner__logo { font-size: var(--banner-font-size); }
    .newsletter-banner__text { font-size: var(--banner-font-size); }
    .newsletter-banner__logo-img { height: var(--banner-font-size); }

    .social-media-button {
      padding: 1.25rem 1.5rem;
      font-size: 1.3rem;
    }

    .social-media-button__icon {
      font-size: 1.1rem;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "t:names.blog_posts",
  "blocks": [
    {
      "type": "@theme"
    },
    {
      "type": "@app"
    },
    {
      "type": "text"
    },
    {
      "type": "icon"
    },
    {
      "type": "image"
    },
    {
      "type": "button"
    },
    {
      "type": "video"
    },
    {
      "type": "group"
    },
    {
      "type": "spacer"
    },
    {
      "type": "_divider"
    }
  ],
  "disabled_on": {
    "groups": ["header"]
  },
  "settings": [
    {
      "type": "image_picker",
      "id": "banner_logo",
      "label": "Newsletter banner logo image"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:settings.color_scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:content.padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "t:settings.top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "t:settings.bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    }
  ]
}
{% endschema %}
